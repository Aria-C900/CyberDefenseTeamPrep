#!/bin/bash

#A script for a machine to do an nmap vuln scan against itself
#Largely generated by AI because I'm lazy


# Function to display usage instructions
usage() {
    echo "Usage: $0 [-v] [-p PORT_RANGE] [-o OUTPUT_FILE]"
    echo "-v: Enable verbose mode"
    echo "-p PORT_RANGE: Specify port range (e.g., 1-65535)"
    echo "-o OUTPUT_FILE: Specify output file name"
}

# Parse command-line arguments
VERBOSE=false
PORT_RANGE="1-65535"
OUTPUT_FILE=""

while getopts ":v:p:o:" opt; do
    case $opt in
        v ) VERBOSE=true;;
        p ) PORT_RANGE="$OPTARG";;
        o ) OUTPUT_FILE="$OPTARG";;
        \? ) echo "Invalid option: -$OPTARG" >&2; usage >&2; exit 1 ;;
        : ) echo "Option -$OPTARG requires an argument." >&2; usage >&2; exit 1 ;;
    esac
done

# Check if the script is run as root
if [ "$EUID" -ne 0 ]; then
   echo "Please run as root" >&2
   exit 1
fi

# Perform the nmap scan
echo "Starting nmap scan..."
nmap -v -p $PORT_RANGE -sV --script vuln $HOSTNAME > $OUTPUT_FILE

# Display scan results
if [ "$VERBOSE" = true ]; then
    cat $OUTPUT_FILE
else
    echo "Scan completed. Results saved in $OUTPUT_FILE"
fi

